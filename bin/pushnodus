#! /bin/bash

NODUSWEB=/users/public_html/detcharsummary
RUN_DIRECTORY=$HOME/public_html/summary/

# Make absoulute refernces relative
shopt -s globstar
shopt -s dotglob

cd ${RUN_DIRECTORY}/day

for d0 in */ ; do
  cd $d0
  pwd
  #sed -i -- 's*<base href="/~max.isi/summary/" />*<base href="../.." />*g' *.html
  for d1 in */ ; do
    if [ -d "$d1" ]; then
      cd $d1
      pwd
      #sed -i -- 's*<base href="/~max.isi/summary/" />*<base href="../../.." />*g' *.html
    
      for d2 in */ ; do
        if [ -d "$d2" ]; then
          cd $d2
          pwd
          #sed -i -- 's*<base href="/~max.isi/summary/" />*<base href="../../../.." />*g' *.html
          cd ${RUN_DIRECTORY}/day/$d0/$d1
        fi
      done
      cd ${RUN_DIRECTORY}/day/$d0
    fi
  done
  cd ${RUN_DIRECTORY}/day/
done
# 
# Perform sync
# rsync --exclude archive/ -r ${RUN_DIRECTORY}/ controls@nodus.ligo.caltech.edu:${NODUSWEB} 
# 
# {
#   LOGDIR=/usr1/max.isi/summary/pushnodus-log
#   NOW=$(lalapps_tconvert now)
#   echo "Last push to nodus: $NOW" > $LOGDIR
# }

